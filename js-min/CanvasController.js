class CanvasController{constructor(e){const t=this;t.events={},t._isPaused=!1,t._evt={mouse:[],dimensions:[]},t._vars={},t._physX=[],t.speedMult=1,t.validate(e)}addMethod(e,t){"function"==typeof t&&(this[e]=t)}validate(e){const t=this,s=e.id;let{fps:i,grid:n,background:r,items:a}=e,{draw:o,cellSize:c,lineWidth:l,color:d,lineDash:u}="object"==typeof n?n:{};if(void 0===s||!document.getElementById(s))return;t.id=s,i="number"==typeof i?i:60,t.fps=(()=>i),o="boolean"==typeof o&&o,c="number"==typeof c?c:100,l="number"==typeof l?l:1,d="string"==typeof d?d:"white",u=void 0!==u&&Array.isArray(u)&&2==u.length&&"number"==typeof u.reduce((e,t)=>e+t)?u:[0,0],t.grid=new CanvasGrid({draw:o,cellSize:c,lineWidth:l,strokeStyle:d,lineDash:u}),t.items=[],t.background="string"==typeof r?r:"black";const h=t.getCanvas().getContext("2d",{alpha:!1});t._2D=(()=>h);for(let e in a)t.addItem(a[e]);e.methods.forEach(e=>t.addMethod(e.name,e.function)),t.start()}bg(){return this.background}_bg(e){this.background=e}addItem(e){const t=this,s=t.items.length,i={fillRect:4,arc:5},{shape:n,dimensions:r,physX:a,events:o}="object"==typeof e?e:{};let c="object"==typeof e.color?c:{},{fill:l,stroke:d}="object"==typeof c?c:{},{enable:u,gravity:h,bounce:f,friction:p,acc:b}="object"==typeof a?a:{},m={};if(Object.keys(i).includes(n)&&r.length==i[n]){c.fill="string"==typeof l?l:"black",c.stroke="string"==typeof d?d:"black",u="boolean"==typeof u&&u,t._physX.push(s),a.enable="boolean"==typeof u&&u,a.gravity="number"==typeof h?h:9.81,a.bounce="number"==typeof f?f:.4,a.friction="number"==typeof p?p:0,a.acc=Array.isArray(b)&&2==b.length&&"number"==typeof b.reduce((e,t)=>e+t)?b:[0,0],a.isDragged=!1;const e=t.validateEvents(o);t.registerEvents(s,e),m={shape:n,dimensions:r,color:c,physX:a,events:e},t.items.push(new CanvasItem(m,t._2D()))}}validateEvents(e){const t=[],s=["mousedown","mouseup","mouseover","mouseout","dblclick","click","mousemove","drag"],i=["x","y"];for(let n in e){const r=e[n],{type:a}=r;let{callback:o,assist:c,dragAxis:l,assists:d,bindself:u}=r;const h="string"==typeof a?s.indexOf(a):-1;if(u="boolean"!=typeof u||u,o="function"==typeof o?o:function(){},-1!=h)if(h<7)c="number"==typeof c?c:0,t.push({type:a,assist:c,callback:o,bindself:u});else if(7==h){d=Array.isArray(d)?d:[15,1e3,2e3];let e=[],[s,n,r]=d;switch(s="number"==typeof s?s:15,n="number"==typeof n?n:1e3,r="number"==typeof r?r:2e3,l="string"==typeof l&&i.includes(l)?l:"",e.push({type:"mousedown",assist:s,callback:function(e){e._isDragged(!0),this.disableCursor()}},{type:"mouseup",assist:r,callback:function(e){e._isDragged(!1),this.enableCursor()}}),l){case"x":e.push({type:"mousemove",assist:n,callback:function(e){e.isDragged()&&e._x(this.centerMouseX())},bindself:!0});break;case"y":e.push({type:"mousemove",assist:n,callback:function(e){e.isDragged()&&e._y(this.centerMouseY())},bindself:!0});break;default:e.push({type:"mousemove",assist:n,callback:function(e){if(e.isDragged()){const[t,s]=this.centerMouse();e._xy([t,s])}},bindself:!0})}t.push(...e)}}return t}registerEventType(e){const t=this,s=t.events;"string"==typeof e&&void 0===s[e]&&(t.events[e]=[],t.addHandler(e))}registerEvents(e,t){const s=this,i=t.map(e=>e.type);i.forEach(e=>s.registerEventType(e));for(let n in t){t[n];s.events[i[n]].push([e,n])}}addHandler(e){const t=this,s=t.eventHandler;t.getCanvas().addEventListener(e,s.bind(t))}eventHandler(e){const t=this,s=[e.clientX,e.clientY],i=e.type,n=t.events[i];for(let i in n){const r=n[i][0],a=n[i][1],o=t.items[r],[c,l]=o.xy(),d=o.shape,u=o.events[a],h="number"==typeof u.assist?u.assist:0;let f,p,b,[m,y]=o.abc();"arc"==d?(f=[c-m-h,c+m+h],p=[l-m-h,l+m+h],y=m,b=t.checkMouse({mouse:s,shape:d,center:[c,l],radius:m,assist:h})):(f=[c-h,c+m+h],p=[l-h,l+y+h],b=t.checkMouse({mouse:s,shape:d,bordersX:f,bordersY:p})),b&&(e.mouse={x:e.clientX,y:e.clientY},e.id=r,e.item=o,t._evt=e,0==u.bindself?u.callback():u.callback.call(t,o,e))}}checkMouse({mouse:e,shape:t,bordersX:s,bordersY:i,center:n,radius:r,assist:a}){if("arc"==t){const t=Math.abs(n[0]-e[0]),s=Math.abs(n[1]-e[1]);return Math.sqrt(t**2+s**2)<=r+(a="number"==typeof a?a:0)}return(([e,t],[s,i],[n,r])=>s<=e&&e<=i&&n<=t&&t<=r)(e,s,i)}drawFrame(){const e=this,t=e.items,s=e._isPaused,i=e.fps(),n=e.speedMult;if(0==s){e.canvasAdapt(),e.clearFrame(),e.drawGrid();const s=e.client;for(let e in t)t[e].step(i,n),t[e].inBounds(s),t[e].draw()}}drawGrid(){const e=this.grid;if(1==e.dr()){const t=this,s=t._2D(),{clientWidth:i,clientHeight:n}=t.getCanvas(),r=e.cell(),a=Math.ceil(n/r),o=Math.ceil(i/r);let c=r,l=r;s.lineWidth=e.lWidth(),s.strokeStyle=e.st(),s.setLineDash(e.lDash());for(let e=1;e<o;e++)s.beginPath(),s.moveTo(c,0),s.lineTo(c,n),s.stroke(),c+=r;for(let e=1;e<a;e++)s.beginPath(),s.moveTo(0,l),s.lineTo(i,l),s.stroke(),l+=r;s.lineWidth=1,s.strokeStyle="",s.setLineDash([])}}clearFrame(){const e=this,t=e._2D(),[s,i]=e.client;t.fillStyle=e.bg(),t.fillRect(0,0,s,i)}canvasAdapt(){const e=this,t=e.getCanvas(),{clientWidth:s,clientHeight:i}=t;t.width=s,t.height=i,e.client=[s,i],e.items.forEach(t=>t.client=e.client)}centerMouseX(){return"arc"==this._evt.item.sh()?this._evt.mouse.x:this._evt.mouse.x-this._evt.item.a()/2}centerMouseY(){return"arc"==this._evt.item.sh()?this._evt.mouse.y:this._evt.mouse.y-this._evt.item.b()/2}centerMouse(){return[this.centerMouseX(),this.centerMouseY()]}disableCursor(){this.getCanvas().style.cursor="none"}enableCursor(){this.getCanvas().style.cursor=""}getCanvas(){return document.getElementById(this.id)}start(){const e=this,t=e.drawFrame;let s=0;e.drawnFrames=(()=>s),this.drawFrame(),e.refreshFrame=setInterval(function(){t.bind(this)(),s++}.bind(e),1e3/e.fps())}pause(){this._isPaused=!0}unpause(){this._isPaused=!1}stop(){clearInterval(this.refreshFrame),delete this.refreshFrame}}