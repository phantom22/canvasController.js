class CanvasController{constructor(e){const t=this;t.events={},t._isPaused=!1,t._evt={mouse:[],dimensions:[]},t._vars={},t._physX=[],t.speedMult=1,t.validate(e)}addMethod(e,t){"function"==typeof t&&(this[e]=t)}validate(e){const t=this,s=e.id;let{fps:n,grid:i,background:a,items:r}=e,{enable:o,cellSize:c,lineWidth:l,color:u,lineDash:d}="object"==typeof i?i:{};if(void 0===s||!document.getElementById(s))return;t.id=s;const h=t.getCanvas().getContext("2d",{alpha:!1});t._2D=(()=>h),n="number"==typeof n?n:60,t.fps=(()=>n),o="boolean"==typeof o&&o,c="number"==typeof c?c:100,l="number"==typeof l?l:1,u="string"==typeof u?u:"white",d=void 0!==d&&Array.isArray(d)&&2==d.length&&"number"==typeof d.reduce((e,t)=>e+t)?d:[0,0],t.grid=new CanvasGrid({enable:o,cellSize:c,lineWidth:l,strokeStyle:u,lineDash:d},t._2D()),t.items=[],t.background="string"==typeof a?a:"black";for(let e in r)t.addItem(r[e]);e.methods.forEach(e=>t.addMethod(e.name,e.function)),t.start()}bg(){return this.background}_bg(e){this.background=e}addItem(e){const t=this,s=t.items.length,n={fillRect:4,arc:5},{shape:i,dimensions:a,physX:r,events:o}="object"==typeof e?e:{};let c="object"==typeof e.color?c:{},{fill:l,stroke:u}="object"==typeof c?c:{},{enable:d,gravity:h,bounce:f,friction:p,acc:b}="object"==typeof r?r:{},m={};if(Object.keys(n).includes(i)&&a.length==n[i]){c.fill="string"==typeof l?l:"black",c.stroke="string"==typeof u?u:"black",d="boolean"==typeof d&&d,t._physX.push(s),r.enable="boolean"==typeof d&&d,r.gravity="number"==typeof h?h:9.81,r.bounce="number"==typeof f?f:.4,r.friction="number"==typeof p?p:0,r.acc=Array.isArray(b)&&2==b.length&&"number"==typeof b.reduce((e,t)=>e+t)?b:[0,0],r.isDragged=!1;const e=t.validateEvents(o);t.registerEvents(s,e),m={shape:i,dimensions:a,color:c,physX:r,events:e},t.items.push(new CanvasItem(m,t._2D()))}}validateEvents(e){const t=[],s=["mousedown","mouseup","mouseover","mouseout","dblclick","click","mousemove","drag"],n=["x","y"];for(let i in e){const a=e[i],{type:r}=a;let{callback:o,assist:c,dragAxis:l,assists:u,bindself:d}=a;const h="string"==typeof r?s.indexOf(r):-1;if(d="boolean"!=typeof d||d,o="function"==typeof o?o:function(){},-1!=h)if(h<7)c="number"==typeof c?c:0,t.push({type:r,assist:c,callback:o,bindself:d});else if(7==h){u=Array.isArray(u)?u:[15,1e3,2e3];let e=[],[s,i,a]=u;switch(s="number"==typeof s?s:15,i="number"==typeof i?i:1e3,a="number"==typeof a?a:2e3,l="string"==typeof l&&n.includes(l)?l:"",e.push({type:"mousedown",assist:s,callback:function(e){e._isDragged(!0),this.disableCursor()}},{type:"mouseup",assist:a,callback:function(e){e._isDragged(!1),this.enableCursor()}}),l){case"x":e.push({type:"mousemove",assist:i,callback:function(e){e.isDragged()&&e._x(this.centerMouseX())},bindself:!0});break;case"y":e.push({type:"mousemove",assist:i,callback:function(e){e.isDragged()&&e._y(this.centerMouseY())},bindself:!0});break;default:e.push({type:"mousemove",assist:i,callback:function(e){if(e.isDragged()){const[t,s]=this.centerMouse();e._xy([t,s])}},bindself:!0})}t.push(...e)}}return t}registerEventType(e){const t=this,s=t.events;"string"==typeof e&&void 0===s[e]&&(t.events[e]=[],t.addHandler(e))}registerEvents(e,t){const s=this,n=t.map(e=>e.type);n.forEach(e=>s.registerEventType(e));for(let i in t){t[i];s.events[n[i]].push([e,i])}}addHandler(e){const t=this,s=t.eventHandler;t.getCanvas().addEventListener(e,s.bind(t))}eventHandler(e){const t=this,s=[e.clientX,e.clientY],n=e.type,i=t.events[n];for(let n in i){const a=i[n][0],r=i[n][1],o=t.items[a],[c,l]=o.xy(),u=o.shape,d=o.events[r],h="number"==typeof d.assist?d.assist:0;let f,p,b,[m,y]=o.abc();"arc"==u?(f=[c-m-h,c+m+h],p=[l-m-h,l+m+h],y=m,b=t.checkMouse({mouse:s,shape:u,center:[c,l],radius:m,assist:h})):(f=[c-h,c+m+h],p=[l-h,l+y+h],b=t.checkMouse({mouse:s,shape:u,bordersX:f,bordersY:p})),b&&(e.mouse={x:e.clientX,y:e.clientY},e.id=a,e.item=o,t._evt=e,0==d.bindself?d.callback():d.callback.call(t,o,e))}}checkMouse({mouse:e,shape:t,bordersX:s,bordersY:n,center:i,radius:a,assist:r}){if("arc"==t){const t=Math.abs(i[0]-e[0]),s=Math.abs(i[1]-e[1]);return Math.sqrt(t**2+s**2)<=a+(r="number"==typeof r?r:0)}return(([e,t],[s,n],[i,a])=>s<=e&&e<=n&&i<=t&&t<=a)(e,s,n)}drawFrame(){const e=this,t=e.items,s=e._isPaused,n=e.fps(),i=e.speedMult;if(0==s){e.canvasAdapt(),e.clearFrame();const s=e.client;e.grid.draw(s);for(let e in t)t[e].step(n,i),t[e].inBounds(s),t[e].draw()}}clearFrame(){const e=this,t=e._2D(),[s,n]=e.client;t.fillStyle=e.bg(),t.fillRect(0,0,s,n)}canvasAdapt(){const e=this.getCanvas(),{clientWidth:t,clientHeight:s}=e;e.width=t,e.height=s,this.client=[t,s]}centerMouseX(){return"arc"==this._evt.item.sh()?this._evt.mouse.x:this._evt.mouse.x-this._evt.item.a()/2}centerMouseY(){return"arc"==this._evt.item.sh()?this._evt.mouse.y:this._evt.mouse.y-this._evt.item.b()/2}centerMouse(){return[this.centerMouseX(),this.centerMouseY()]}disableCursor(){this.getCanvas().style.cursor="none"}enableCursor(){this.getCanvas().style.cursor=""}getCanvas(){return document.getElementById(this.id)}start(){const e=this,t=e.drawFrame;let s=0;e.drawnFrames=(()=>s),this.drawFrame(),e.refreshFrame=setInterval(function(){t.bind(this)(),s++}.bind(e),1e3/e.fps())}pause(){this._isPaused=!0}unpause(){this._isPaused=!1}stop(){clearInterval(this.refreshFrame),delete this.refreshFrame}}