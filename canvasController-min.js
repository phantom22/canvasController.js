class CanvasController{constructor(e){const t=this;t.events={},t._isPaused=!1,t._evt={mouse:[],dimensions:[]},t._vars={},t._physX=[],t.speedMult=1,t.validate(e)}validate(e){const t=this,s=e.id;let{fps:i,items:n,grid:r}=e;if(void 0===s||!document.getElementById(s))return;t.id=s,i="number"==typeof i?i:60,t.fps=(()=>i),t.grid="boolean"==typeof r&&r,t.items=[];const o=t.getCanvas().getContext("2d");t._2D=(()=>o);for(let e in n)t.addItem(n[e]);t.start()}addItem(e){const t=this,s=t.items.length,i={fillRect:4,arc:5},{shape:n,dimensions:r,physX:o,events:a}="object"==typeof e?e:{};let c="object"==typeof e.color?c:{},{fill:h,stroke:l}="object"==typeof c?c:{},{enable:u,gravity:d,bounce:y,friction:m,acc:f}="object"==typeof o?o:{},p={};if(Object.keys(i).includes(n)&&r.length==i[n]){c.fill="string"==typeof h?h:"black",c.stroke="string"==typeof l?l:"black",(u="boolean"==typeof u&&u)&&(t._physX.push(s),o.enable=u,o.gravity="number"==typeof d?d:9.81,o.bounce="number"==typeof y?y:.4,o.friction="number"==typeof m?m:0,o.acc=Array.isArray(f)&&2==f.length&&"number"==typeof f.reduce((e,t)=>e+t)?f:[0,0],o.isDragged=!1);const e=t.validateEvents(a);t.registerEvents(s,e),p={shape:n,dimensions:r,color:c,physX:o,events:e},t.items.push(new CanvasItem(p))}}validateEvents(e){const t=[],s=["mousedown","mouseup","mouseover","mouseout","dblclick","click","mousemove","drag"],i=["x","y"];for(let n in e){const r=e[n],{type:o}=r;let{callback:a,assist:c,dragAxis:h,assists:l,bindself:u}=r;const d="string"==typeof o?s.indexOf(o):-1;if(u="boolean"!=typeof u||u,a="function"==typeof a?a:function(){},-1!=d)if(d<7)c="number"==typeof c?c:0,t.push({type:o,assist:c,callback:a,bindself:u});else if(7==d){l=Array.isArray(l)?l:[15,1e3,2e3];let e=[],[s,n,r]=l;switch(s="number"==typeof s?s:15,n="number"==typeof n?n:1e3,r="number"==typeof r?r:2e3,h="string"==typeof h&&i.includes(h)?h:"",e.push({type:"mousedown",assist:s,callback:function(e){e._isDragged(!0),this.disableCursor()}},{type:"mouseup",assist:r,callback:function(e){e._isDragged(!1),this.enableCursor()}}),h){case"x":e.push({type:"mousemove",assist:n,callback:function(e){e.isDragged()&&e._x(this.centerMouseX())},bindself:!0});break;case"y":e.push({type:"mousemove",assist:n,callback:function(e){e.isDragged()&&e._y(this.centerMouseY())},bindself:!0});break;default:e.push({type:"mousemove",assist:n,callback:function(e){if(e.isDragged()){const[t,s]=this.centerMouse();e._xy({x:t,y:s})}},bindself:!0})}t.push(...e)}}return t}registerEventType(e){const t=this,s=t.events;"string"==typeof e&&void 0===s[e]&&(t.events[e]=[],t.addHandler(e))}registerEvents(e,t){const s=this,i=t.map(e=>e.type);i.forEach(e=>s.registerEventType(e));for(let n in t){t[n];s.events[i[n]].push([e,n])}}addHandler(e){const t=this,s=t.eventHandler;t.getCanvas().addEventListener(e,s.bind(t))}eventHandler(e){const t=this,s=[e.clientX,e.clientY],i=e.type,n=t.events[i];for(let i in n){const r=n[i][0],o=n[i][1],a=t.items[r],[c,h]=a.xy(),l=a.shape,u=a.events[o],d="number"==typeof u.assist?u.assist:0;let y,m,f,[p,b]=a.abc();"arc"==l?(y=[c-p-d,c+p+d],m=[h-p-d,h+p+d],b=p,f=t.checkMouse({mouse:s,shape:l,center:[c,h],radius:p,assist:d})):(y=[c-d,c+p+d],m=[h-d,h+b+d],f=t.checkMouse({mouse:s,shape:l,bordersX:y,bordersY:m})),f&&(e.mouse={x:e.clientX,y:e.clientY},e.id=r,e.item=a,t._evt=e,0==u.bindself?u.callback():u.callback.call(t,a,e))}}gravity(){if(!this._isPaused){const e=this,t=e._physX,s=e.fps(),[i,n]=e.client,r=(e,[t,s])=>{let i=0;return t>=e?i=-1:s<=e&&(i=1),i};for(let o in t){const a=t[o],c=e.items[a];if(c.enable()&&!c.isDragged()){const t=c.phX(),{gravity:o,bounce:a,friction:h,acc:l}=t,{shape:u,dimensions:d}=c,[y,m]=d,f=e.speedMult;let p,b,v,g,_=[];if(l[0]=l[0]*(1-h/100),_[0]=y+l[0]/s*f,l[1]+=o/s*f,_[1]=m+l[1],"arc"==u){const e=c.a();p=[e,i-e],b=[e,n-e]}else{const[e,t]=c.abc();p=[0,i-e],b=[0,n-t]}const k=r(_[0],p),X=r(_[1],b);0!=k&&0==X?(v=-1==k?p[0]:p[1],c._acc(l),c._xy({x:v,y:_[1]}),c.hBounce()):0!=X&&0==k?(v=-1==X?b[0]:b[1],c._xy({x:_[0],y:v}),c.vBounce()):0!=k&&0!=X?(v=-1==k?p[0]:p[1],g=-1==X?b[0]:b[1],c.hBounce(),c.vBounce(),c._xy({x:v,y:g})):(c._acc(l),c._xy({x:_[0],y:_[1]}))}else c.isDragged()&&c._acc([0,0])}}}checkMouse({mouse:e,shape:t,bordersX:s,bordersY:i,center:n,radius:r,assist:o}){if("arc"==t){const t=Math.abs(n[0]-e[0]),s=Math.abs(n[1]-e[1]);return Math.sqrt(t**2+s**2)<=r+(o="number"==typeof o?o:0)}return(([e,t],[s,i],[n,r])=>s<=e&&e<=i&&n<=t&&t<=r)(e,s,i)}drawFrame(){const e=this,t=e.items;if(0==e._isPaused){e.canvasAdapt(),e.drawGrid(),e.gravity();for(let s in t)e.drawItem(s)}}drawGrid(){if(1==this.grid){const e=this,t=e._2D(),{clientWidth:s,clientHeight:i}=e.getCanvas(),n=60,r=Math.ceil(i/n),o=Math.ceil(s/n);let a=n,c=n;t.lineWidth=2,t.strokeStyle="#1a1a1a",t.setLineDash([7,5]);for(let e=1;e<o;e++)t.beginPath(),t.moveTo(a,0),t.lineTo(a,i),t.stroke(),a+=n;for(let e=1;e<r;e++)t.beginPath(),t.moveTo(0,c),t.lineTo(s,c),t.stroke(),c+=n;t.lineWidth=1,t.strokeStyle="",t.setLineDash([])}}clearFrame(){const e=this._2D(),[t,s]=this.client;e.clearRect(0,0,t,s)}canvasAdapt(){const e=this.getCanvas(),{clientWidth:t,clientHeight:s}=e;e.width=t,e.height=s,this.client=[t,s]}drawItem(e){const t=this.items,s=this._2D();if(void 0!==t[e]){const i=t[e],[n,r,o,a,c]=i.dims(),{shape:h,color:l}=i,{fill:u,stroke:d}=l;switch(s.fillStyle="string"==typeof u?u:"black",s.strokeStyle="string"==typeof d?d:s.fillStyle,h){case"fillRect":s[h](n,r,o,a);break;case"arc":s.beginPath(),s[h](n,r,o,a,c),s.fill(),s.stroke()}}}randomizeItemState(e){const t=this,s=t.items[e],i=[-15,-11,-7,7,11,15],n=[15,20,25,30,35];if("arc"==s.shape){const e=s.a(),[r,o]=t.client,a=Math.floor(Math.random()*(r-2*e))+e,c=Math.floor(Math.random()*(o-5*e))+3*e,h=Math.floor(1e3*Math.random())+500;s._gravity(i[Math.floor(Math.random()*i.length)]),s._a(n[Math.floor(Math.random()*n.length)]),s._xy({x:a,y:c}),s._hAcc(h)}}setItemRandomColor(e){const t=`rgba(${Math.floor(255*Math.random())},${Math.floor(255*Math.random())},${Math.floor(255*Math.random())},0.4)`;this.items[e]._fill(t),this.items[e]._stroke(t)}centerMouseX(){return"arc"==this._evt.item.sh()?this._evt.mouse.x:this._evt.mouse.x-this._evt.item.a()/2}centerMouseY(){return"arc"==this._evt.item.sh()?this._evt.mouse.y:this._evt.mouse.y-this._evt.item.b()/2}centerMouse(){return[this.centerMouseX(),this.centerMouseY()]}disableCursor(){this.getCanvas().style.cursor="none"}enableCursor(){this.getCanvas().style.cursor=""}getCanvas(){return document.getElementById(this.id)}start(){const e=this,t=e.drawFrame;let s=0;e.drawnFrames=(()=>s),this.drawFrame(),e.refreshFrame=setInterval(function(){t.bind(this)(),s++}.bind(e),1e3/e.fps())}pause(){this._isPaused=!0}unpause(){this._isPaused=!1}stop(){clearInterval(this.refreshFrame),delete this.refreshFrame}}class CanvasItem{constructor(e){for(let t in e)this[t]=e[t]}sh(){return this.shape}_sh(e){this.shape=e}dims(){return this.dimensions}_dims(e){this.dimensions=e}x(){return this.dimensions[0]}_x(e){this.dimensions[0]=e}y(){return this.dimensions[1]}_y(e){this.dimensions[1]=e}xy(){return this.dimensions.slice(0,2)}_xy({x:e,y:t}){this.dimensions[0]=e,this.dimensions[1]=t}a(){return this.dimensions[2]}_a(e){this.dimensions[2]=e}b(){return this.dimensions[3]}_b(e){this.dimensions[3]=e}c(){return this.dimensions[4]}_c(e){this.dimensions[4]=e}abc(){return this.dimensions.slice(2)}color(){return this.color}_color({fill:e,stroke:t}){this.color.fill=e,this.color.stroke=t}fill(){return this.color.fill}_fill(e){this.color.fill=e}stroke(){return this.color.stroke}_stroke(e){this.color.stroke=e}phX(){return this.physX}enable(){return this.physX.enable}_enable(e){this.physX.enable=e}gravity(){return this.physX.gravity}_gravity(e){this.physX.gravity=e}bounce(){return this.physX.bounce}_bounce(e){this.physX.bounce=e}hBounce(){this.physX.acc[0]*=-this.physX.bounce}vBounce(){this.physX.acc[1]*=-this.physX.bounce}friction(){return this.physX.friction}_friction(e){this.physX.friction=e}acc(){return this.physX.acc}_acc([e,t]){this.physX.acc[0]=e,this.physX.acc[1]=t}hAcc(){return this.physX.acc[0]}_hAcc(e){this.physX.acc[0]=e}vAcc(){return this.physX.acc[1]}_vAcc(e){this.physX.acc[1]=e}isDragged(){return this.physX.isDragged}_isDragged(e){this.physX.isDragged=e}events(){return this.events}event(e){return this.events[e]}}